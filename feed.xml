<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>DDtKey's blog</title>
    <description>DDtKey's personal website &amp; blog.</description>
    <link>https://ddtkey.com/</link>
    <atom:link href="https://ddtkey.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 21 Jun 2022 10:17:49 +0000</pubDate>
    <lastBuildDate>Tue, 21 Jun 2022 10:17:49 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>

    
      <item>
        <title>Authorization mechanisms in Rust web applications</title>
        <description>&lt;p&gt;To ensure application security, we use mechanisms such as authentication and authorization. I think many of you are familiar with these concepts and in this article we will focus on the concept of authorization and related access control models.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img alt=&quot;security&quot; width=&quot;500&quot; src=&quot;/assets/img/posts/authz-in-rust/security.png&quot; /&gt;
&lt;/p&gt;

&lt;details&gt;
  &lt;summary&gt;&lt;b&gt;&lt;i&gt;Definitions of terms used in the article&lt;/i&gt;&lt;/b&gt;&lt;/summary&gt;

  &lt;p&gt;It’s important to understand the difference between authorization and authentication:&lt;/p&gt;

  &lt;blockquote&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Authentication&lt;/em&gt;&lt;/strong&gt; – a process of verifying your identity and proving that you are a user of the system (by means of a password, token or any other form of credentials).&lt;/p&gt;
  &lt;/blockquote&gt;

  &lt;blockquote&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Authorization&lt;/em&gt;&lt;/strong&gt; - a mechanism whose task is to allow or deny a request for a specific system resource.&lt;/p&gt;
  &lt;/blockquote&gt;

  &lt;blockquote&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Access subject&lt;/em&gt;&lt;/strong&gt; – a user or process that is requesting access to the resource.&lt;/p&gt;
  &lt;/blockquote&gt;

  &lt;blockquote&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Access object&lt;/em&gt;&lt;/strong&gt; – on the contrary, it’s a resource to which access is requested by the subject.&lt;/p&gt;
  &lt;/blockquote&gt;

  &lt;blockquote&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Crate&lt;/em&gt;&lt;/strong&gt; – a library or executable (binary) program in Rust.&lt;/p&gt;
  &lt;/blockquote&gt;

&lt;/details&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;The authorization process includes the concept of &lt;strong&gt;&lt;em&gt;access control policy&lt;/em&gt;&lt;/strong&gt;, in accordance with which the set of permissible actions of a particular user (access subject) over the system resources (access objects) is determined.&lt;/p&gt;

&lt;p&gt;And also the &lt;strong&gt;&lt;em&gt;access control model&lt;/em&gt;&lt;/strong&gt; is a general scheme for delimiting access through a user policy, which we choose depending on various factors and system requirements.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Let’s take a look at the basic access control models:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;DAC&lt;/strong&gt; - &lt;em&gt;Discretionary access-control&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img alt=&quot;Discretionary access-control&quot; width=&quot;200&quot; align=&quot;right&quot; src=&quot;/assets/img/posts/authz-in-rust/dac.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This paradigm allows users to independently grant the right to any action on their data to other system participants, for which &lt;em&gt;access control lists&lt;/em&gt; (&lt;strong&gt;ACL&lt;/strong&gt;) are used.&lt;/p&gt;

&lt;p&gt;Most often used in cases where users directly own certain resources and can independently decide who to allow interaction with them.&lt;/p&gt;

&lt;p&gt;An example would be operating systems or social networks, where people independently change the visibility of their content.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;MAC&lt;/strong&gt; - &lt;em&gt;Mandatory access-control&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img alt=&quot;Discretionary access-control&quot; width=&quot;200&quot; align=&quot;left&quot; src=&quot;/assets/img/posts/authz-in-rust/mac.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It was developed for government purposes with a focus on application in extremely secure systems (for example, military), where it was most widespread.&lt;/p&gt;

&lt;p&gt;Data protection is based on confidentiality labels (level of secrecy or importance), through which the level of access of subjects is checked. As a rule, the rights are issued centrally by the management body.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;MAC&lt;/em&gt; is perhaps one of the most rigorous and secure models, but it comes with the complexity and high cost of implementing and maintaining the infrastructure around it (there are many ways that require careful planning).&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;RBAC&lt;/strong&gt; - &lt;em&gt;Role-Based access-control&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The most common and well-known model that fits well with business domains and correlates with job functions. It is a kind of development of &lt;em&gt;DAC&lt;/em&gt;, where privileges are grouped into their respective roles.&lt;/p&gt;

&lt;p&gt;Each subject can have a list of roles, where the role, in turn, can provide access to a certain list of objects.&lt;/p&gt;

&lt;p&gt;It should be noted that in RBAC the &lt;strong&gt;PBAC&lt;/strong&gt; (&lt;em&gt;Permission-Based access-control&lt;/em&gt;) model is sometimes allocated when a set of actions is allocated for each resource in the system (for example: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;READ_DOCUMENT&lt;/code&gt;,&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt; WRITE_DOCUMENT &lt;/code&gt;,&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt; DELETE_DOCUMENT&lt;/code&gt;) and bind it with the subject through the relationship with roles, directly with the user, or a hybrid approach, when the subject can have a role and separate privileges.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ABAC&lt;/strong&gt; - &lt;em&gt;Attribute-Based access-control&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img alt=&quot;Discretionary access-control&quot; width=&quot;500&quot; src=&quot;/assets/img/posts/authz-in-rust/abac.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;In this approach, it’s necessary to maintain special policies that combine the attributes of subjects and objects, and the access decision is provided based on the analysis and comparison of these attributes.&lt;/p&gt;

&lt;p&gt;This is the most flexible of the described models with a huge number of possible combinations, which allows making decisions based on such parameters as request time, location, employee position, etc., but requires more detailed planning of policies to prevent unauthorized access.&lt;/p&gt;

&lt;p&gt;ABAC requires some mechanism for interpreting policies and some syntactic subset, which can entail execution time (in the case of a dynamic implementation) or compilation (in the case of code generation).&lt;/p&gt;

&lt;p&gt;You can read more about some of the models in &lt;a href=&quot;https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html#permission-based-access-control&quot;&gt;OWASP materials&lt;/a&gt; (Open Web Application Security Project) and in &lt;a href=&quot;https://www.ibm.com/docs/en/sig-and-i/10.0.0?topic=planning-access-control-models&quot;&gt;IBM documentation&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Access control is a very important part of web applications, since it is necessary to strictly observe the delimitation of access to resources and data (especially personal ones - the protection of which is provided for by legislative aspects), depending on the privileges of users.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;what-do-we-have-in-rust-web-frameworks&quot;&gt;What do we have in Rust web frameworks?&lt;/h2&gt;

&lt;p&gt;Typically, to implement anti-tampering mechanisms in popular web frameworks (such as actix-web, Rocket, or tide), &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Middleware&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FromRequest&lt;/code&gt;, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Guard&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Filter&lt;/code&gt; in the case of warp) implementations are used.&lt;/p&gt;

&lt;p&gt;That is, in some kind of middleware, where data about the subject and object of access can be extracted from requests. This approach is quite convenient, since it will allow you to delimit areas of responsibility.&lt;/p&gt;

&lt;p&gt;It can be both library (in the form of crates), and custom implementations. But at the moment, the preference is often given to own implementations, which is probably due to the small number of production-ready solutions and the specifics of the applied policies in various projects.&lt;/p&gt;

&lt;h3 id=&quot;casbin-rs&quot;&gt;&lt;a href=&quot;https://github.com/casbin/casbin-rs&quot;&gt;casbin-rs&lt;/a&gt;&lt;/h3&gt;

&lt;p align=&quot;center&quot;&gt;
    &lt;a href=&quot;https://github.com/casbin/casbin-rs&quot;&gt;
        &lt;img alt=&quot;casbin-rs&quot; src=&quot;/assets/img/posts/authz-in-rust/casbin.png&quot; /&gt;
    &lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/casbin/casbin-rs/commits/master&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/last-commit/casbin/casbin-rs&quot; alt=&quot;GitHub last commit&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://crates.io/crates/casbin&quot;&gt;&lt;img src=&quot;https://img.shields.io/crates/v/casbin.svg&quot; alt=&quot;Crates.io&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://crates.io/crates/casbin&quot;&gt;&lt;img src=&quot;https://img.shields.io/crates/d/casbin&quot; alt=&quot;crates.io&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://docs.rs/casbin&quot;&gt;&lt;img src=&quot;https://docs.rs/casbin/badge.svg&quot; alt=&quot;Docs&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://github.com/casbin/casbin-rs/actions&quot;&gt;&lt;img src=&quot;https://github.com/casbin/casbin-rs/workflows/CI/badge.svg&quot; alt=&quot;CI&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://codecov.io/gh/casbin/casbin-rs&quot;&gt;&lt;img src=&quot;https://codecov.io/gh/casbin/casbin-rs/branch/master/graph/badge.svg&quot; alt=&quot;Codecov&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://gitter.im/casbin/lobby&quot;&gt;&lt;img src=&quot;https://badges.gitter.im/Join%20Chat.svg&quot; alt=&quot;Gitter&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://forum.casbin.org/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/forum-join-%23cde201&quot; alt=&quot;forum&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The most complete production-ready open source solution that I have been able to find is the adaptation of Casbin (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;casbin-rs&lt;/code&gt;), with an impressive number of supported access models (&lt;em&gt;ACL, RBAC, ABAC&lt;/em&gt; declared) and the ability to flexibly change policy by changing only the configuration file …&lt;/p&gt;

&lt;p&gt;Casbin uses its own meta-model &lt;em&gt;PERM (Policy, Effect, Request, Matchers)&lt;/em&gt; to build an access model, which gives more flexibility, but introduces the cost of its interpretation and validation.&lt;/p&gt;

&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Request definition
&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;[request_definition]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sub, obj, act&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Policy definition
&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;[policy_definition]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sub, obj, act&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Policy effect
&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;[policy_effect]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;some(where (p.eft == allow))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Matchers
&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;[matchers]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;r.sub == p.sub &amp;amp;&amp;amp; r.obj == p.obj &amp;amp;&amp;amp; r.act == p.act&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When describing it, you can easily make a mistake, and therefore the &lt;a href=&quot;https://casbin.org/editor/&quot;&gt;web editor of models&lt;/a&gt; was developed for convenient and correct modification.&lt;/p&gt;

&lt;p&gt;The administration of privileges for your system occurs through the description of the policy (in a file or database) corresponding to the PERM model format.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;p, alice, data1, read
p, bob, data2, write
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, this causes a certain duplication of object and subject identifiers and is not obvious at the level of the calling code.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;casbin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;prelude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[tokio::main]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Enforcer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;examples/acl_model.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;examples/acl_policy.csv&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;.await&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.enable_log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;alice&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// the user that wants to access a resource.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;data1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// the resource that is going to be accessed.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// the operation that the user performs on the resource.&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authorized&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.enforce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;authorized&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;// permit alice to read data1&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;// deny the request&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;// error occurs&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Such a tool definitely deserves respect. Many thanks to the community for contributing to its development 👏 !&lt;/p&gt;

&lt;p&gt;But, as we can see, developers take into account certain nuances and sometimes want to write their own solutions from project to project, since the requirements can be defined initially, and all the flexibility provided by the library may not be needed, and therefore, we can choose a narrower and lighter solution. that meets our requirements.&lt;/p&gt;

&lt;p&gt;As it was with me when I started writing a backend in Rust. The PBAC model was enough for me, and based on my experience in developing web applications, in most typical projects, the &lt;em&gt;ACL&lt;/em&gt;/&lt;em&gt;RBAC&lt;/em&gt; models are enough.&lt;/p&gt;

&lt;p&gt;I came up with the idea of implementing my own solution as a separate open source crate: &lt;em&gt;actix-web-grants&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;actix-web-grants&quot;&gt;&lt;a href=&quot;https://github.com/DDtKey/actix-web-grants&quot;&gt;actix-web-grants&lt;/a&gt;&lt;/h3&gt;

&lt;p align=&quot;center&quot;&gt;
    &lt;a href=&quot;https://github.com/DDtKey/actix-web-grants&quot;&gt;
        &lt;img alt=&quot;actix-web-grants&quot; src=&quot;/assets/img/posts/authz-in-rust/awg.png&quot; /&gt;
    &lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/DDtKey/actix-web-grants/actions&quot;&gt;&lt;img src=&quot;https://github.com/DDtKey/actix-web-grants/workflows/CI/badge.svg&quot; alt=&quot;CI&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://crates.io/crates/actix-web-grants&quot;&gt;&lt;img src=&quot;https://img.shields.io/crates/d/actix-web-grants&quot; alt=&quot;Crates.io Downloads Badge&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://crates.io/crates/actix-web-grants&quot;&gt;&lt;img src=&quot;https://img.shields.io/crates/v/actix-web-grants&quot; alt=&quot;crates.io&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://docs.rs/actix-web-grants&quot;&gt;&lt;img src=&quot;https://docs.rs/actix-web-grants/badge.svg&quot; alt=&quot;Documentation&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://deps.rs/repo/github/DDtKey/actix-web-grants&quot;&gt;&lt;img src=&quot;https://deps.rs/repo/github/DDtKey/actix-web-grants/status.svg&quot; alt=&quot;dependency status&quot; /&gt;&lt;/a&gt;
&lt;img src=&quot;https://img.shields.io/crates/l/actix-web-grants&quot; alt=&quot;Apache 2.0 or MIT licensed&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The main idea of the project is to use built-in middleware to get user privileges from a request and specify the necessary permissions directly on your endpoints.&lt;/p&gt;

&lt;p&gt;This is a fairly lightweight crate with simple integration, using which you can at least apply the following models: access lists (ACL), role-based or permission-based access control (&lt;em&gt;RBAC&lt;/em&gt;/&lt;em&gt;PBAC&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;Thus, we just need to implement the function of obtaining privileges:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;// Sample application with grant protection based on extracting by your custom function&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;#[actix_web::main]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nn&quot;&gt;HttpServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;auth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;GrantsMiddleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;with_extractor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extract&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nn&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;.wrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;.service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;.bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;localhost:8081&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;.run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;.await&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;extract&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ServiceRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// Here is a place for your code to get user permissions/grants from a request&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// For example from a token or database&lt;/span&gt;
    
    &lt;span class=&quot;c&quot;&gt;// Stub example&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ROLE_ADMIN&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This approach adds flexibility and allows us to implement authorization regardless of the methods of authentication and storage of user privileges: it can be a &lt;em&gt;JWT token&lt;/em&gt;, a &lt;em&gt;database&lt;/em&gt;, an &lt;em&gt;intermediate cache&lt;/em&gt;, or &lt;em&gt;any other solution&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Then we can place restrictions directly on our resources (via macro):&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;actix_web_grants&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;proc_macro&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;has_roles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[get(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/secure&quot;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;#[has_roles(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ROLE_ADMIN&quot;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;macro_secured&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpResponse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nn&quot;&gt;HttpResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ADMIN_RESPONSE&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ability to change to access policy directly in the code is a distinctive part of &lt;em&gt;actix-web-grants&lt;/em&gt;, reducing duplication of access objects and providing us with visual information about the required privileges.&lt;/p&gt;

&lt;p&gt;For the sake of completeness, minimal examples of applications with an identical usage profile were written and the performance of the authorization process was measured (based on &lt;a href=&quot;https://github.com/wg/wrk&quot;&gt;wrk&lt;/a&gt;) to satisfy our own interest.&lt;/p&gt;

&lt;p&gt;The examples are written with a simplified implementation of the RBAC model for two test cases of authorization: a request to a resource is allowed and denied, in accordance with the presence of the necessary roles. Stubs were used for authentication. All code is available on GitHub: &lt;em&gt;&lt;a href=&quot;https://github.com/DDtKey/actix-web-authz-benchmark&quot;&gt;actix-web-authz-benchmark&lt;/a&gt;&lt;/em&gt; (more examples can always be found on the pages of these projects).&lt;/p&gt;

&lt;p&gt;The benchmark results can be seen in the table:&lt;/p&gt;

&lt;div class=&quot;table-responsive&quot;&gt;
    &lt;table class=&quot;table table-bordered&quot;&gt;
      &lt;tr&gt;
       &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;Benchmark&lt;/td&gt;
       &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;strong&gt;casbin-rs&lt;/strong&gt;&lt;/td&gt;
       &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;strong&gt;actix-web-grants&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
       &lt;td&gt;Latency&lt;/td&gt;
       &lt;td&gt;Req/Sec&lt;/td&gt;
       &lt;td&gt;Latency&lt;/td&gt;
       &lt;td&gt;Req/Sec&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
       &lt;td&gt;Allowed Endpoint&lt;/td&gt;
       &lt;td&gt;6.18 ms&lt;/td&gt;
       &lt;td&gt;16.27k&lt;/td&gt;
       &lt;td&gt;4.41 ms&lt;/td&gt;
       &lt;td&gt;22.69k&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
       &lt;td&gt;Denied Endpoint&lt;/td&gt;
       &lt;td&gt;6.70 ms&lt;/td&gt;
       &lt;td&gt;14.98k&lt;/td&gt;
       &lt;td&gt;4.94 ms&lt;/td&gt;
       &lt;td&gt;20.23k&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;rustc: v1.52.0 (stable); CPU: 2,6 GHz 6-Core Intel Core i7; RAM: 16 GB&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Thus, we see that &lt;a href=&quot;https://github.com/DDtKey/actix-web-grants&quot;&gt;actix-web-grants&lt;/a&gt; makes it easier to integrate and administer access policies over endpoints (endpoints), while not inferior in performance compared to &lt;a href=&quot;https://github.com/casbin/casbin-rs&quot;&gt;casbin-rs&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;post-scriptum&quot;&gt;Post Scriptum&lt;/h4&gt;

&lt;p&gt;This library does not yet have integrations with many web frameworks in its arsenal, but I have plans to introduce some abstractions and write modules for other frameworks, make some improvements (for example, the ability to inherit roles and support custom types). Any suggestions and contributions will be welcome!&lt;/p&gt;

</description>
        <pubDate>Mon, 10 May 2021 00:00:00 +0000</pubDate>
        <link>https://ddtkey.com/blog/authz-mechanisms-in-Rust/</link>
        <guid isPermaLink="true">https://ddtkey.com/blog/authz-mechanisms-in-Rust/</guid>
      </item>
    

    
      
        
      
    
      
    
      
        
          <item>
            <title></title>
            <description>&lt;h3&gt;  {{ page.title }} &lt;/h3&gt;

&lt;div id=&quot;categories&quot;&gt;
{% for category in site.categories %}
  &lt;div class=&quot;category-box&quot; &gt;
    {% capture category_name %}{{ category | first }}{% endcapture %}
    &lt;div id=&quot;#{{ category_name | slugize }}&quot;&gt;&lt;/div&gt;
    &lt;h4 class=&quot;category-head&quot;&gt;&lt;a href=&quot;{{ site.baseurl }}/blog/categories/{{ category_name }}&quot;&gt;{{ category_name }}&lt;/a&gt;&lt;/h4&gt;
    &lt;a name=&quot;{{ category_name | slugize }}&quot;&gt;&lt;/a&gt;
     {% for post in site.categories[category_name] %}
    &lt;article class=&quot;center&quot;&gt;
      &lt;h6 &gt;&lt;a href=&quot;{{ site.baseurl }}{{ post.url }}&quot;&gt;{{post.title}}&lt;/a&gt;&lt;/h6&gt;
    &lt;/article&gt;


    {% endfor %}

  &lt;/div&gt;
{% endfor %}
&lt;/div&gt;


</description>
            <link>https://ddtkey.com/blog/categories/</link>
          </item>
        
      
    
      
    
      
    
      
    
      
    
      
        
          <item>
            <title>Get Started</title>
            <description>## Getting Started - How to use “devlopr-jekyll” theme

## What's Jekyll ?

If you aren’t familiar with Jekyll yet, you should know that it is a static site generator. It will transform your plain text into static websites and blogs. No more databases, slow loading websites, risk of being hacked…just your content. And not only that, with Jekyll you get free hosting with GitHub Pages! If you are a beginner we recommend you start with [Jekyll’s Docs](https://jekyllrb.com/docs/installation/). Now, if you know how to use Jekyll, let’s move on to using this theme in Jekyll:

### Steps to create your blog using devlopr-jekyll and Host using Github Pages :

&gt;  **Step 1.**  Fork the repo - [click here](https://github.com/sujaykundu777/devlopr-jekyll/fork)

![Devlopr Jekyll Repo](/assets/img/posts/fork1.png){:class=&quot;img-fluid&quot;}

&gt; **Step 2.** Use **your-github-username.github.io** as the new repo  ( Replace your-github-username with yours). Remember if you use the name other than your-github-username.github.io , your blog will be built using gh-pages branch.

![Devlopr Jekyll Repo](/assets/img/posts/fork2.png){:class=&quot;img-fluid&quot;}

![Devlopr Jekyll Repo](/assets/img/posts/fork3.png){:class=&quot;img-fluid&quot;}

&gt; **Step 3.** Clone the new repo locally to make changes :

![Devlopr Jekyll Repo](/assets/img/posts/fork31.png){:class=&quot;img-fluid&quot;}

![Devlopr Jekyll Repo](/assets/img/posts/fork32.png){:class=&quot;img-fluid&quot;}

![Devlopr Jekyll Repo](/assets/img/posts/fork33.png){:class=&quot;img-fluid&quot;}

```bash
 $ git clone https://github.com/yourusername/yourusername.github.io
 $ cd yourusername.github.io
 $ code .
```

&gt; **Step 4.** Open the files using VSCode and edit _config.yml and edit with your details:

- _config.yml file - replace with your own details
- _posts - Add your blog posts here
- _includes - You can replace the contents of the files with your data. (contains widgets)
- _assets/img - Add all your images here

![Devlopr Jekyll Repo](/assets/img/posts/fork34.png){:class=&quot;img-fluid&quot;}

&gt; **Step 5** - Install the development requirements:

### Set up local development environment

1. [Git](https://git-scm.com/)
2. [Ruby](https://www.ruby-lang.org/) and [Bundler](https://bundler.io/)
3. [VSCode](https://code.visualstudio.com/download)

We need ruby and bundler to build our site locally. After installation check if its working:

For ruby :

```bash
$ ruby -v
ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux-gnu]
```
For bundler :

```bash
$ gem install bundler
$ bundler -v
Bundler version 2.2.6
```
Add jekyll :

```bash
$ bundle add jekyll
```
 This command will add the Jekyll gem to our Gemfile and install it to the ./vendor/bundle/ folder.

You can check the jekyll version

```
$ bundle exec jekyll -v
jekyll 4.2.0
```

&gt; **Step 6.** Install the gem dependencies by running the following command

```bash
$ bundle update
$ bundle install
```

&gt; **Step 7.** Serve the site locally by running the following command below:

```bash
$ bundle exec jekyll serve --watch
```
or you can also serve using :

```bash
$ jekyll serve
```

Visit [http://localhost:4000](http://localhost:4000) for development server

![Devlopr Jekyll Repo](/assets/img/posts/fork4.png){:class=&quot;img-fluid&quot;}

![Devlopr Jekyll Repo](/assets/img/posts/fork41.png){:class=&quot;img-fluid&quot;}

### Adding Content

Start populating your blog by adding your .md files in _posts. devlopr-jekyll already has a few examples.

#### YAML Post Example:

```yml
---
layout: post
title: Sample Post
author: Sujay Kundu
date: '2019-05-21 14:35:23 +0530'
category:
        - jekyll
summary: This is the summary for the sample post
thumbnail: sample.png
---

Hi ! This is sample post.

```

#### YAML Page Example:

```yml
---
layout: page
title: Sample Page
menus: header
permalink: /sample-page/
---

Hi ! This is sample page.
```

#### Editing stylesheet

You’ll only work with a single file to edit/add theme style: assets/css/main.scss.

### Deploy your Changes

Once happy with your blog changes. Push your changes to master branch.

&gt; **Step 8.** Push Your Local Changes

```bash
 $ git add .
 $ git commit -m &quot;my new blog using devlopr-jekyll&quot;
 $ git push origin master
```

Visit your Github Repo settings ! Enable master branch as Github Pages Branch :

![Devlopr Jekyll Repo](/assets/img/posts/fork6.png){:class=&quot;img-fluid&quot;}

&gt; **Step 9.** Deploy your Blog :

![Devlopr Jekyll Repo](/assets/img/posts/fork7.png){:class=&quot;img-fluid&quot;}

&gt; Congrats ! On your new shining Blog !

You can visit the blog using [http://your-github-username.github.io](http://your-github-username.github.io).

</description>
            <link>https://ddtkey.com/get-started/</link>
          </item>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

  </channel>
</rss>