<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8" /> <title> Authorization mechanisms in Rust web applications -DDtKey's blog </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="- Authorization mechanisms in Rust web applications"> <meta name="keywords" content="Authorization mechanisms in Rust web applications, DDtKey's blog, rust, authz,how to configure authz, actix-web, casbin, access-control"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="DDtKey's blog" property="og:site_name" /> <meta content="Authorization mechanisms in Rust web applications" property="og:title" /> <meta content="article" property="og:type" /> <meta content="" property="og:description" /> <meta content="https://ddtkey.com/blog/authz-mechanisms-in-Rust/" property="og:url" /> <meta content="2021-05-10T00:00:00+00:00" property="article:published_time" /> <meta content="https://ddtkey.com/about/" property="article:author" /> <meta content="https://ddtkey.com/assets/img/posts/authz-in-rust/preview.png" property="og:image" /> <meta content="rust" property="article:section" /> <meta content="authz," property="article:tag" /> <meta content="api" property="article:tag" /> <meta content="security," property="article:tag" /> <meta content="authorization," property="article:tag" /> <meta content="access-control," property="article:tag" /> <meta content="rust," property="article:tag" /> <meta content="casbin," property="article:tag" /> <meta content="actix-web" property="article:tag" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Authorization mechanisms in Rust web applications" /> <meta name="twitter:url" content="https://ddtkey.com/blog/authz-mechanisms-in-Rust/" /> <meta name="twitter:description" content="" /> <link rel="stylesheet" href="https://ddtkey.com/assets/css/main.css" /> <!-- <link rel="stylesheet" href="https://ddtkey.com/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="https://ddtkey.com/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="https://ddtkey.com/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'https://ddtkey.com' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="https://ddtkey.com/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="https://ddtkey.com/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://ddtkey.com/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <script src="https://ddtkey.com/assets/js/custom-functions.js"></script> <script> function getCurrentHost() { return window.location.protocol + "//" + window.location.host; } function getDefaultBaseUrl() { return getCurrentHost() + "/blog/authz-mechanisms-in-Rust/"; } function redirectToDefaultBaseUrl() { window.location.replace(getDefaultBaseUrl()); } </script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- Yandex.Metrika counter --> <script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(78304510, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/78304510" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">DDtKey's blog</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="/about" >About</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item btn-group"> <!-- jekyll-polyglot will process ferh= into href= through the static_href liquid block tag without relativizing the url; useful for making language navigation switchers --> <a class="btn btn-link btn-lang-switch btn-lang-switch__active disabled" onClick="javascript:redirectToDefaultBaseUrl()" href="#" > English </a> <a class="btn btn-link btn-lang-switch " href="/ru/blog/authz-mechanisms-in-Rust/" > Русский </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="container-fluid"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Authorization mechanisms in Rust web applications</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="https://ddtkey.com/blog/authors/ddtkey">DDtKey</a></span> </span > <time datetime="2021-05-10 00:00:00 +0000" itemprop="datePublished" >May 10, 2021</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/authz-mechanisms-in-Rust/" ></span> <div class="post-categories"> Category : <a href="/blog/category/rust" >rust</a > &nbsp; <a href="/blog/category/authz" >authz</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://ddtkey.com/assets/img/posts/authz-in-rust/preview.png" alt="" /> <br /> <br /> <p>To ensure application security, we use mechanisms such as authentication and authorization. I think many of you are familiar with these concepts and in this article we will focus on the concept of authorization and related access control models.</p> <p align="center"> <img alt="security" width="500" src="/assets/img/posts/authz-in-rust/security.png" /> </p> <details> <summary><b><i>Definitions of terms used in the article</i></b></summary> <p>It’s important to understand the difference between authorization and authentication:</p> <blockquote> <p><strong><em>Authentication</em></strong> – a process of verifying your identity and proving that you are a user of the system (by means of a password, token or any other form of credentials).</p> </blockquote> <blockquote> <p><strong><em>Authorization</em></strong> - a mechanism whose task is to allow or deny a request for a specific system resource.</p> </blockquote> <blockquote> <p><strong><em>Access subject</em></strong> – a user or process that is requesting access to the resource.</p> </blockquote> <blockquote> <p><strong><em>Access object</em></strong> – on the contrary, it’s a resource to which access is requested by the subject.</p> </blockquote> <blockquote> <p><strong><em>Crate</em></strong> – a library or executable (binary) program in Rust.</p> </blockquote> </details> <p><br /></p> <p>The authorization process includes the concept of <strong><em>access control policy</em></strong>, in accordance with which the set of permissible actions of a particular user (access subject) over the system resources (access objects) is determined.</p> <p>And also the <strong><em>access control model</em></strong> is a general scheme for delimiting access through a user policy, which we choose depending on various factors and system requirements.</p> <p><strong>Let’s take a look at the basic access control models:</strong></p> <ul> <li><strong>DAC</strong> - <em>Discretionary access-control</em></li> </ul> <p><img alt="Discretionary access-control" width="200" align="right" src="/assets/img/posts/authz-in-rust/dac.png" /></p> <p>This paradigm allows users to independently grant the right to any action on their data to other system participants, for which <em>access control lists</em> (<strong>ACL</strong>) are used.</p> <p>Most often used in cases where users directly own certain resources and can independently decide who to allow interaction with them.</p> <p>An example would be operating systems or social networks, where people independently change the visibility of their content.</p> <ul> <li><strong>MAC</strong> - <em>Mandatory access-control</em></li> </ul> <p><img alt="Discretionary access-control" width="200" align="left" src="/assets/img/posts/authz-in-rust/mac.png" /></p> <p>It was developed for government purposes with a focus on application in extremely secure systems (for example, military), where it was most widespread.</p> <p>Data protection is based on confidentiality labels (level of secrecy or importance), through which the level of access of subjects is checked. As a rule, the rights are issued centrally by the management body.</p> <p><em>MAC</em> is perhaps one of the most rigorous and secure models, but it comes with the complexity and high cost of implementing and maintaining the infrastructure around it (there are many ways that require careful planning).</p> <ul> <li><strong>RBAC</strong> - <em>Role-Based access-control</em></li> </ul> <p>The most common and well-known model that fits well with business domains and correlates with job functions. It is a kind of development of <em>DAC</em>, where privileges are grouped into their respective roles.</p> <p>Each subject can have a list of roles, where the role, in turn, can provide access to a certain list of objects.</p> <p>It should be noted that in RBAC the <strong>PBAC</strong> (<em>Permission-Based access-control</em>) model is sometimes allocated when a set of actions is allocated for each resource in the system (for example: <code class="language-plaintext highlighter-rouge">READ_DOCUMENT</code>,<code class="language-plaintext highlighter-rouge"> WRITE_DOCUMENT </code>,<code class="language-plaintext highlighter-rouge"> DELETE_DOCUMENT</code>) and bind it with the subject through the relationship with roles, directly with the user, or a hybrid approach, when the subject can have a role and separate privileges.</p> <ul> <li><strong>ABAC</strong> - <em>Attribute-Based access-control</em></li> </ul> <p align="center"> <img alt="Discretionary access-control" width="500" src="/assets/img/posts/authz-in-rust/abac.png" /> </p> <p>In this approach, it’s necessary to maintain special policies that combine the attributes of subjects and objects, and the access decision is provided based on the analysis and comparison of these attributes.</p> <p>This is the most flexible of the described models with a huge number of possible combinations, which allows making decisions based on such parameters as request time, location, employee position, etc., but requires more detailed planning of policies to prevent unauthorized access.</p> <p>ABAC requires some mechanism for interpreting policies and some syntactic subset, which can entail execution time (in the case of a dynamic implementation) or compilation (in the case of code generation).</p> <p>You can read more about some of the models in <a href="https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html#permission-based-access-control">OWASP materials</a> (Open Web Application Security Project) and in <a href="https://www.ibm.com/docs/en/sig-and-i/10.0.0?topic=planning-access-control-models">IBM documentation</a>.</p> <p>Access control is a very important part of web applications, since it is necessary to strictly observe the delimitation of access to resources and data (especially personal ones - the protection of which is provided for by legislative aspects), depending on the privileges of users.</p> <hr /> <h2 id="what-do-we-have-in-rust-web-frameworks">What do we have in Rust web frameworks?</h2> <p>Typically, to implement anti-tampering mechanisms in popular web frameworks (such as actix-web, Rocket, or tide), <code class="language-plaintext highlighter-rouge">Middleware</code>, <code class="language-plaintext highlighter-rouge">FromRequest</code>, or <code class="language-plaintext highlighter-rouge">Guard</code> (<code class="language-plaintext highlighter-rouge">Filter</code> in the case of warp) implementations are used.</p> <p>That is, in some kind of middleware, where data about the subject and object of access can be extracted from requests. This approach is quite convenient, since it will allow you to delimit areas of responsibility.</p> <p>It can be both library (in the form of crates), and custom implementations. But at the moment, the preference is often given to own implementations, which is probably due to the small number of production-ready solutions and the specifics of the applied policies in various projects.</p> <h3 id="casbin-rs"><a href="https://github.com/casbin/casbin-rs">casbin-rs</a></h3> <p align="center"> <a href="https://github.com/casbin/casbin-rs"> <img alt="casbin-rs" src="/assets/img/posts/authz-in-rust/casbin.png" /> </a> </p> <p><a href="https://github.com/casbin/casbin-rs/commits/master"><img src="https://img.shields.io/github/last-commit/casbin/casbin-rs" alt="GitHub last commit" /></a> <a href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/v/casbin.svg" alt="Crates.io" /></a> <a href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/d/casbin" alt="crates.io" /></a> <a href="https://docs.rs/casbin"><img src="https://docs.rs/casbin/badge.svg" alt="Docs" /></a> <a href="https://github.com/casbin/casbin-rs/actions"><img src="https://github.com/casbin/casbin-rs/workflows/CI/badge.svg" alt="CI" /></a> <a href="https://codecov.io/gh/casbin/casbin-rs"><img src="https://codecov.io/gh/casbin/casbin-rs/branch/master/graph/badge.svg" alt="Codecov" /></a> <a href="https://gitter.im/casbin/lobby"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter" /></a> <a href="https://forum.casbin.org/"><img src="https://img.shields.io/badge/forum-join-%23cde201" alt="forum" /></a></p> <p>The most complete production-ready open source solution that I have been able to find is the adaptation of Casbin (<code class="language-plaintext highlighter-rouge">casbin-rs</code>), with an impressive number of supported access models (<em>ACL, RBAC, ABAC</em> declared) and the ability to flexibly change policy by changing only the configuration file …</p> <p>Casbin uses its own meta-model <em>PERM (Policy, Effect, Request, Matchers)</em> to build an access model, which gives more flexibility, but introduces the cost of its interpretation and validation.</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Request definition
</span><span class="nn">[request_definition]</span>
<span class="py">r</span> <span class="p">=</span> <span class="s">sub, obj, act</span>

<span class="c"># Policy definition
</span><span class="nn">[policy_definition]</span>
<span class="py">p</span> <span class="p">=</span> <span class="s">sub, obj, act</span>

<span class="c"># Policy effect
</span><span class="nn">[policy_effect]</span>
<span class="py">e</span> <span class="p">=</span> <span class="s">some(where (p.eft == allow))</span>

<span class="c"># Matchers
</span><span class="nn">[matchers]</span>
<span class="py">m</span> <span class="p">=</span> <span class="s">r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act</span>
</code></pre></div></div> <p>When describing it, you can easily make a mistake, and therefore the <a href="https://casbin.org/editor/">web editor of models</a> was developed for convenient and correct modification.</p> <p>The administration of privileges for your system occurs through the description of the policy (in a file or database) corresponding to the PERM model format.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p, alice, data1, read
p, bob, data2, write
</code></pre></div></div> <p>Unfortunately, this causes a certain duplication of object and subject identifiers and is not obvious at the level of the calling code.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">casbin</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">Enforcer</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"examples/acl_model.conf"</span><span class="p">,</span> <span class="s">"examples/acl_policy.csv"</span><span class="p">)</span><span class="k">.await</span><span class="o">?</span><span class="p">;</span>
    <span class="n">e</span><span class="nf">.enable_log</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">sub</span> <span class="o">=</span> <span class="s">"alice"</span><span class="p">;</span> <span class="c">// the user that wants to access a resource.</span>
    <span class="k">let</span> <span class="n">obj</span> <span class="o">=</span> <span class="s">"data1"</span><span class="p">;</span> <span class="c">// the resource that is going to be accessed.</span>
    <span class="k">let</span> <span class="n">act</span> <span class="o">=</span> <span class="s">"read"</span><span class="p">;</span> <span class="c">// the operation that the user performs on the resource.</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">authorized</span><span class="p">)</span> <span class="o">=</span> <span class="n">e</span><span class="nf">.enforce</span><span class="p">((</span><span class="n">sub</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">act</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">authorized</span> <span class="p">{</span>
            <span class="c">// permit alice to read data1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c">// deny the request</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c">// error occurs</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Such a tool definitely deserves respect. Many thanks to the community for contributing to its development 👏 !</p> <p>But, as we can see, developers take into account certain nuances and sometimes want to write their own solutions from project to project, since the requirements can be defined initially, and all the flexibility provided by the library may not be needed, and therefore, we can choose a narrower and lighter solution. that meets our requirements.</p> <p>As it was with me when I started writing a backend in Rust. The PBAC model was enough for me, and based on my experience in developing web applications, in most typical projects, the <em>ACL</em>/<em>RBAC</em> models are enough.</p> <p>I came up with the idea of implementing my own solution as a separate open source crate: <em>actix-web-grants</em>.</p> <h3 id="actix-web-grants"><a href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a></h3> <p align="center"> <a href="https://github.com/DDtKey/actix-web-grants"> <img alt="actix-web-grants" src="/assets/img/posts/authz-in-rust/awg.png" /> </a> </p> <p><a href="https://github.com/DDtKey/actix-web-grants/actions"><img src="https://github.com/DDtKey/actix-web-grants/workflows/CI/badge.svg" alt="CI" /></a> <a href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/d/actix-web-grants" alt="Crates.io Downloads Badge" /></a> <a href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/v/actix-web-grants" alt="crates.io" /></a> <a href="https://docs.rs/actix-web-grants"><img src="https://docs.rs/actix-web-grants/badge.svg" alt="Documentation" /></a> <a href="https://deps.rs/repo/github/DDtKey/actix-web-grants"><img src="https://deps.rs/repo/github/DDtKey/actix-web-grants/status.svg" alt="dependency status" /></a> <img src="https://img.shields.io/crates/l/actix-web-grants" alt="Apache 2.0 or MIT licensed" /></p> <p>The main idea of the project is to use built-in middleware to get user privileges from a request and specify the necessary permissions directly on your endpoints.</p> <p>This is a fairly lightweight crate with simple integration, using which you can at least apply the following models: access lists (ACL), role-based or permission-based access control (<em>RBAC</em>/<em>PBAC</em>).</p> <p>Thus, we just need to implement the function of obtaining privileges:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Sample application with grant protection based on extracting by your custom function</span>
<span class="nd">#[actix_web::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nn">HttpServer</span><span class="p">::</span><span class="nf">new</span><span class="p">(||</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">auth</span> <span class="o">=</span> <span class="nn">GrantsMiddleware</span><span class="p">::</span><span class="nf">with_extractor</span><span class="p">(</span><span class="n">extract</span><span class="p">);</span>
        <span class="nn">App</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span>
            <span class="nf">.wrap</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
            <span class="nf">.service</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nf">.bind</span><span class="p">(</span><span class="s">"localhost:8081"</span><span class="p">)</span><span class="o">?</span>
    <span class="nf">.run</span><span class="p">()</span>
    <span class="k">.await</span>
<span class="p">}</span>

<span class="k">async</span> <span class="k">fn</span> <span class="nf">extract</span><span class="p">(</span><span class="mi">_</span><span class="n">req</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ServiceRequest</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// Here is a place for your code to get user permissions/grants from a request</span>
    <span class="c">// For example from a token or database</span>
    
    <span class="c">// Stub example</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="n">ROLE_ADMIN</span><span class="nf">.to_string</span><span class="p">()])</span>
<span class="p">}</span>
</code></pre></div></div> <p>This approach adds flexibility and allows us to implement authorization regardless of the methods of authentication and storage of user privileges: it can be a <em>JWT token</em>, a <em>database</em>, an <em>intermediate cache</em>, or <em>any other solution</em>.</p> <p>Then we can place restrictions directly on our resources (via macro):</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">actix_web_grants</span><span class="p">::</span><span class="nn">proc_macro</span><span class="p">::{</span><span class="n">has_roles</span><span class="p">};</span>

<span class="nd">#[get(</span><span class="s">"/secure"</span><span class="nd">)]</span>
<span class="nd">#[has_roles(</span><span class="s">"ROLE_ADMIN"</span><span class="nd">)]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">macro_secured</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">HttpResponse</span> <span class="p">{</span>
    <span class="nn">HttpResponse</span><span class="p">::</span><span class="nf">Ok</span><span class="p">()</span><span class="nf">.body</span><span class="p">(</span><span class="s">"ADMIN_RESPONSE"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>The ability to change to access policy directly in the code is a distinctive part of <em>actix-web-grants</em>, reducing duplication of access objects and providing us with visual information about the required privileges.</p> <p>For the sake of completeness, minimal examples of applications with an identical usage profile were written and the performance of the authorization process was measured (based on <a href="https://github.com/wg/wrk">wrk</a>) to satisfy our own interest.</p> <p>The examples are written with a simplified implementation of the RBAC model for two test cases of authorization: a request to a resource is allowed and denied, in accordance with the presence of the necessary roles. Stubs were used for authentication. All code is available on GitHub: <em><a href="https://github.com/DDtKey/actix-web-authz-benchmark">actix-web-authz-benchmark</a></em> (more examples can always be found on the pages of these projects).</p> <p>The benchmark results can be seen in the table:</p> <div class="table-responsive"> <table class="table table-bordered"> <tr> <td rowspan="2" align="center">Benchmark</td> <td colspan="2" align="center"><strong>casbin-rs</strong></td> <td colspan="2" align="center"><strong>actix-web-grants</strong></td> </tr> <tr> <td>Latency</td> <td>Req/Sec</td> <td>Latency</td> <td>Req/Sec</td> </tr> <tr> <td>Allowed Endpoint</td> <td>6.18 ms</td> <td>16.27k</td> <td>4.41 ms</td> <td>22.69k</td> </tr> <tr> <td>Denied Endpoint</td> <td>6.70 ms</td> <td>14.98k</td> <td>4.94 ms</td> <td>20.23k</td> </tr> </table> </div> <blockquote> <p><em>rustc: v1.52.0 (stable); CPU: 2,6 GHz 6-Core Intel Core i7; RAM: 16 GB</em></p> </blockquote> <p>Thus, we see that <a href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a> makes it easier to integrate and administer access policies over endpoints (endpoints), while not inferior in performance compared to <a href="https://github.com/casbin/casbin-rs">casbin-rs</a>.</p> <h4 id="post-scriptum">Post Scriptum</h4> <p>This library does not yet have integrations with many web frameworks in its arsenal, but I have plans to introduce some abstractions and write modules for other frameworks, make some improvements (for example, the ability to inherit roles and support custom types). Any suggestions and contributions will be welcome!</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Artem Medvedev </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="https://ddtkey.com/assets/img/authors/ddtkey.png" alt="Artem Medvedev" /> </div> <div class="col-md-6"> <p class="author_bio">Hi, my name is Artem. I'm a backend developer (Rust, Java)</p> <p>Email : <a href="mailto:%69@%64%64%74%6B%65%79.%63%6F%6D" title="Contact me">i@ddtkey.com</a></p> <p>Website : https://ddtkey.com</p> <p class="profile-links"> <a class="social-link" href="https://github.com/DDtKey" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/ddtkey" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/DDttKey" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> <a class="social-link" href="https://instagram.com/ddttkey" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> <a class="social-link" href="https://telegram.com/DDtKey" target="_blank"><i class="fab fa-telegram fa-fw"></i></a> </p> </div> </div> </div> </div> </div><div class="giscus" id="giscus_thread"></div></article> <script src="https://giscus.app/client.js" data-repo="DDtKey/DDtKey.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzNjU4NTk0NjY=" data-category="Announcements" data-category-id="DIC_kwDOFc6Sis4CAbCS" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async> </script></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Artem Medvedev</div> <div class="card-body"> <p class="author_bio">Hi, my name is Artem Medvedev. I'm a software engineer (Rust, Java, Kotlin, Typescript). <br/> I'm a big fan of software development, it's more than just a job for me. <br/> I always strive for professional growth, gaining new knowledge and opportunities 🚀 <br/></p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/DDtKey" data-size="large" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-show-count="true" aria-label="Follow @DDtKey on GitHub">Follow @DDtKey</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#rust"></div> <li class="tag-head"> <a href="/blog/category/rust">rust</a> </li> <a name="rust"></a> <div id="#authz"></div> <li class="tag-head"> <a href="/blog/category/authz">authz</a> </li> <a name="authz"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="https://ddtkey.com/">Home</a> </li> <li> <a href="https://ddtkey.com/blog">Blog</a> </li> <li> <a href="https://ddtkey.com/about">About</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll theme</a> and available on <a href="https://github.com/DDtKey/DDtKey.github.io">GitHub</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script src="https://ddtkey.com/assets/js/mode-switcher.js"></script> </body> </html>
