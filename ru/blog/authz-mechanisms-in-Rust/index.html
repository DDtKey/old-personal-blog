<!DOCTYPE html> <html lang="ru"><head> <meta charset="utf-8" /> <title> Механизмы авторизации в web-приложениях на Rust -DDtKey's blog </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="- Механизмы авторизации в web-приложениях на Rust"> <meta name="keywords" content="Механизмы авторизации в web-приложениях на Rust, DDtKey's blog, rust, authz,настройка авторизации, actix-web, casbin, контроль доступа"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/ru/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="DDtKey's blog" property="og:site_name" /> <meta content="Механизмы авторизации в web-приложениях на Rust" property="og:title" /> <meta content="article" property="og:type" /> <meta content="" property="og:description" /> <meta content="https://ddtkey.com/blog/authz-mechanisms-in-Rust/" property="og:url" /> <meta content="2021-05-10T00:00:00+00:00" property="article:published_time" /> <meta content="https://ddtkey.com/about/" property="article:author" /> <meta content="https://ddtkey.com/assets/img/posts/authz-in-rust/preview.png" property="og:image" /> <meta content="rust" property="article:section" /> <meta content="authz," property="article:tag" /> <meta content="api" property="article:tag" /> <meta content="security," property="article:tag" /> <meta content="authorization," property="article:tag" /> <meta content="access-control," property="article:tag" /> <meta content="rust" property="article:tag" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Механизмы авторизации в web-приложениях на Rust" /> <meta name="twitter:url" content="https://ddtkey.com/blog/authz-mechanisms-in-Rust/" /> <meta name="twitter:description" content="" /> <link rel="stylesheet" href="https://ddtkey.com/ru/assets/css/main.css" /> <!-- <link rel="stylesheet" href="https://ddtkey.com/ru/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="https://ddtkey.com/ru/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/ru/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/ru/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="https://ddtkey.com/ru/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="https://ddtkey.com/ru/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'https://ddtkey.com' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="https://ddtkey.com/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="https://ddtkey.com/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="https://ddtkey.com/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://ddtkey.com/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <script src="https://ddtkey.com/assets/js/custom-functions.js"></script> <script> function getCurrentHost() { return window.location.protocol + "//" + window.location.host; } function getDefaultBaseUrl() { return getCurrentHost() + "/blog/authz-mechanisms-in-Rust/"; } function redirectToDefaultBaseUrl() { window.location.replace(getDefaultBaseUrl()); } </script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- Yandex.Metrika counter --> <script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(78304510, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/78304510" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/ru/">DDtKey's blog</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/ru/" >Главная</a > </li> <li class="nav-item"> <a class="nav-link" href="/ru/blog" >Блог</a > </li> <li class="nav-item"> <a class="nav-link" href="/ru/about" >Обо мне</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item btn-group"> <!-- jekyll-polyglot will process ferh= into href= through the static_href liquid block tag without relativizing the url; useful for making language navigation switchers --> <a class="btn btn-link btn-lang-switch " onClick="javascript:redirectToDefaultBaseUrl()" href="#" > English </a> <a class="btn btn-link btn-lang-switch btn-lang-switch__active disabled" href="/ru/blog/authz-mechanisms-in-Rust/" > Русский </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="container-fluid"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Механизмы авторизации в web-приложениях на Rust</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Опубликовал : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="https://ddtkey.com/ru/blog/authors/ddtkey">DDtKey</a></span> </span > <time datetime="2021-05-10 00:00:00 +0000" itemprop="datePublished" >May 10, 2021</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/authz-mechanisms-in-Rust/" ></span> <div class="post-categories"> Категория : <a href="/ru/blog/category/rust" >rust</a > &nbsp; <a href="/ru/blog/category/authz" >authz</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://ddtkey.com/assets/img/posts/authz-in-rust/preview.png" alt="" /> <br /> <br /> <p>Для обеспечения безопасности приложений мы используем такие механизмы как аутентификация и авторизация. Думаю, многие из вас знакомы с этими концепциями и в этой статье мы сфокусируемся на понятие авторизации и связанных с ней моделях контроля доступа.</p> <p align="center"> <img alt="security" width="500" src="/assets/img/posts/authz-in-rust/security.png" /> </p> <details> <summary><b><i>Определения терминов, которые используются в статье</i></b></summary> <p>Важно понимать отличия авторизации от аутентификации:</p> <blockquote> <p><strong><em>Аутентификация</em></strong> – процесс подтверждения вашей личности и доказательства того, что вы являетесь непосредственным клиентом системы (посредством пароля, токена или любой другой формы учетных данных).</p> </blockquote> <blockquote> <p><strong><em>Авторизация</em></strong> в свою очередь – это механизм, в результате которого запрос к определенному ресурсу системы должен быть разрешен или отклонен.</p> </blockquote> <blockquote> <p><strong><em>Субъект доступа</em></strong> – пользователь или процесс, который запрашивает доступ к ресурсу.</p> </blockquote> <blockquote> <p><strong><em>Объект доступа</em></strong> – напротив, является ресурсом, к которому запрашивается доступ со стороны субъекта.</p> </blockquote> <blockquote> <p><strong><em>Крейт</em> (<em>Crate</em>)</strong> – библиотека или исполняемая программа в Rust.</p> </blockquote> </details> <p>К процессу авторизации относится понятие <strong><em>политики контроля доступа</em></strong>, в соответствии с которой и определяется набор допустимых действий конкретного пользователя (субъекта доступа) над ресурсами системы (объект доступа).</p> <p>А также <strong><em>модель контроля доступа</em></strong> – общая схема для разграничения доступа посредством пользовательской политики, которую мы выбираем в зависимости от различных факторов и требований к системе.</p> <p><strong>Давайте рассмотрим основные модели контроля доступа:</strong></p> <ul> <li><strong>DAC</strong> (<em>Discretionary access-control</em>) – избирательное (дискреционное) управление доступом</li> </ul> <p><img alt="Discretionary access-control" width="200" align="right" src="/assets/img/posts/authz-in-rust/dac.png" /></p> <p>Данная парадигма позволяет пользователям самостоятельно передавать право на какие-либо действия над его данными другим участникам системы, для чего используются <em>списки контроля доступа</em> (<strong>ACL</strong>).</p> <p>Наиболее распространено применение в случаях, когда пользователи непосредственно владеют некими ресурсами и могут самостоятельно решать кому позволять взаимодействие с ними.</p> <p>Примером могут служить операционные системы или социальные сети, где люди самостоятельно меняют видимость их контента.</p> <ul> <li><strong>MAC</strong> (<em>Mandatory access-control</em>) – мандатное управление доступом</li> </ul> <p><img alt="Discretionary access-control" width="200" align="left" src="/assets/img/posts/authz-in-rust/mac.png" /></p> <p>Была разработана в государственных целях с акцентом на применение в чрезвычайно защищенных системах (например, военных), где и получила наибольшее распространение.</p> <p>Защита данных основана на метках конфиденциальности (уровень секретности или важности), с помощью которых происходит проверка наличия уровня доступа у субъектов. Характерным также является централизованная выдача прав управляющим органом.</p> <p>Пожалуй, MAC одна из самых строгих и безопасных моделей, но с этим связана сложность и высокая стоимостьреализации и поддержания инфраструктуры вокруг этого решения (есть множество способов, требующих тщательного планирования).</p> <ul> <li><strong>RBAC</strong> (<em>Role-Based access-control</em>) – управление доступом на основе ролей</li> </ul> <p>Наиболее распространенная и многим известная модель, которая хорошо накладывается на предметные бизнес-области и коррелирует с должностными функциями. Является неким развитием <em>DAC</em>, где привилегии группируются в соответствующие им роли.</p> <p>Каждый субъект может обладать перечнем ролей, где роль в свою очередь может предоставлять доступ к некому перечню объектов.</p> <p>Следует отметить, что в рамках RBAC иногда выделяют <strong>PBAC</strong> (<em>Permission-Based access-control</em>) модель контроля доступа на основе разрешений, когда для каждого ресурса системы выделяется набор действий (например: <code class="language-plaintext highlighter-rouge">READ_DOCUMENT</code>, <code class="language-plaintext highlighter-rouge">WRITE_DOCUMENT</code>, <code class="language-plaintext highlighter-rouge">DELETE_DOCUMENT</code>) и связывают с субъектом через соотношение с ролями, напрямую с пользователем или гибридным подходом – где субъект может обладать ролью и отдельными привилегиями.</p> <ul> <li><strong>ABAC</strong> (<em>Attribute-Based access-control</em>) – управление доступом на основе атрибутов</li> </ul> <p align="center"> <img alt="Discretionary access-control" width="500" src="/assets/img/posts/authz-in-rust/abac.png" /> </p> <p>В данном подходе необходимо ведение специальных политик, которые объединяют атрибуты субъектов и объектов, а решение о допуске предоставляется на основе анализа и сравнительной оценки этих атрибутов.</p> <p>Это наиболее гибкий из описанных подходов с огромным количеством возможных комбинаций, который позволяет принимать решения на основе таких параметров, как время запроса, местоположение, должность сотрудника и т.п., но требует более детального планирования политик для предотвращения несанкционированного доступа.</p> <p>Для применения ABAC требуется некий механизм интерпретации политик и некого синтаксического подмножества, что может влечь за собой затраты времени исполнения (в случае динамической реализации) или компиляции (при генерации кода).</p> <p>Подробнее о некоторых из них можно почитать в <a href="https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html#permission-based-access-control">материалах OWASP</a> (Open Web Application Security Project) и в <a href="https://www.ibm.com/docs/en/sig-and-i/10.0.0?topic=planning-access-control-models">документации IBM</a>.</p> <p>Контроль доступа составляет очень важную часть веб приложений, поскольку необходимо строго соблюдать разграничение доступа к ресурсам и данным в зависимости от привилегий пользователей и в особенности персональным данным, защита которых предусмотрена законодательными аспектами.</p> <hr /> <h2 id="что-мы-имеем-в-веб-фреймворках-на-rust">Что мы имеем в веб-фреймворках на Rust?</h2> <p>Как правило, для реализации механизмов защиты от несанкционированного доступа в популярных веб-фреймворках (таких, как actix-web, Rocket или tide), используются реализации <code class="language-plaintext highlighter-rouge">Middleware</code>, <code class="language-plaintext highlighter-rouge">FromRequest</code> или <code class="language-plaintext highlighter-rouge">Guard</code> (<code class="language-plaintext highlighter-rouge">Filter</code> в случае warp).</p> <p>То есть в неком промежуточном ПО, где из запросов можно извлечь данные о субъекте и объекте доступа. Такой подход довольно удобен, поскольку позволят разграничить зоны ответственности.</p> <p>Это могут быть как библиотечные реализации в виде крейтов, так и пользовательские. Но на текущий момент, предпочтения отдают собственным реализациям, что вероятно связано с небольшим количеством готовых реализаций и спецификой применяемых политик в рамках различных проектов.</p> <h3 id="casbin-rs"><a href="https://github.com/casbin/casbin-rs">casbin-rs</a></h3> <p align="center"> <a href="https://github.com/casbin/casbin-rs"> <img alt="casbin-rs" src="/assets/img/posts/authz-in-rust/casbin.png" /> </a> </p> <p><a href="https://github.com/casbin/casbin-rs/commits/master"><img src="https://img.shields.io/github/last-commit/casbin/casbin-rs" alt="GitHub last commit" /></a> <a href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/v/casbin.svg" alt="Crates.io" /></a> <a href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/d/casbin" alt="crates.io" /></a> <a href="https://docs.rs/casbin"><img src="https://docs.rs/casbin/badge.svg" alt="Docs" /></a> <a href="https://github.com/casbin/casbin-rs/actions"><img src="https://github.com/casbin/casbin-rs/workflows/CI/badge.svg" alt="CI" /></a> <a href="https://codecov.io/gh/casbin/casbin-rs"><img src="https://codecov.io/gh/casbin/casbin-rs/branch/master/graph/badge.svg" alt="Codecov" /></a> <a href="https://gitter.im/casbin/lobby"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter" /></a> <a href="https://forum.casbin.org/"><img src="https://img.shields.io/badge/forum-join-%23cde201" alt="forum" /></a></p> <p>Наиболее обширное production-ready решение с открытым исходным кодом, которое мне удалось найти – это адаптация Casbin (casbin-rs), с внушительным количеством поддерживаемых моделей доступа (заявлены ACL, RBAC, ABAC) и возможностью гибкого изменения политики посредством изменения только лишь конфигурационного файла.</p> <p>В casbin используется своя мета-модель <em>PERM (Policy, Effect, Request, Matchers)</em> для построения модели доступа, что дает большую гибкость, но привносит затраты на ее интерпретацию и валидацию.</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Request definition
</span><span class="nn">[request_definition]</span>
<span class="py">r</span> <span class="p">=</span> <span class="s">sub, obj, act</span>

<span class="c"># Policy definition
</span><span class="nn">[policy_definition]</span>
<span class="py">p</span> <span class="p">=</span> <span class="s">sub, obj, act</span>

<span class="c"># Policy effect
</span><span class="nn">[policy_effect]</span>
<span class="py">e</span> <span class="p">=</span> <span class="s">some(where (p.eft == allow))</span>

<span class="c"># Matchers
</span><span class="nn">[matchers]</span>
<span class="py">m</span> <span class="p">=</span> <span class="s">r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act</span>
</code></pre></div></div> <p>При ее описании можно легко допустить ошибку, в связи с чем был разработан <a href="https://casbin.org/editor/">веб-редактор моделей</a> для удобной и корректной модификации</p> <p>Администрирование привилегий для вашей системы происходит через описание политики (в файле или базе данных), соответствующей формату PERM модели.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p, alice, data1, read
p, bob, data2, write
</code></pre></div></div> <p>К сожалению, это вызывает определенное дублирование идентификаторов объектов и субъектов и неочевидность на уровне вызывающего кода.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">casbin</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">Enforcer</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"examples/acl_model.conf"</span><span class="p">,</span> <span class="s">"examples/acl_policy.csv"</span><span class="p">)</span><span class="k">.await</span><span class="o">?</span><span class="p">;</span>
    <span class="n">e</span><span class="nf">.enable_log</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">sub</span> <span class="o">=</span> <span class="s">"alice"</span><span class="p">;</span> <span class="c">// the user that wants to access a resource.</span>
    <span class="k">let</span> <span class="n">obj</span> <span class="o">=</span> <span class="s">"data1"</span><span class="p">;</span> <span class="c">// the resource that is going to be accessed.</span>
    <span class="k">let</span> <span class="n">act</span> <span class="o">=</span> <span class="s">"read"</span><span class="p">;</span> <span class="c">// the operation that the user performs on the resource.</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">authorized</span><span class="p">)</span> <span class="o">=</span> <span class="n">e</span><span class="nf">.enforce</span><span class="p">((</span><span class="n">sub</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">act</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">authorized</span> <span class="p">{</span>
            <span class="c">// permit alice to read data1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c">// deny the request</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c">// error occurs</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Такой инструмент определенно заслуживает уважения. Огромное спасибо сообществу, которое вносит свой вклад в его развитие!</p> <p>Но, как мы можем наблюдать, разработчики учитывают определенные нюансы и отсюда вытекает стремление писать собственные решения из проекта в проект, поскольку требования могут быть детерминированы изначально, а вся предоставляемая гибкость может так и не понадобиться, и следовательно, мы вольны выбирать более узкую и легковесную реализацию, подходящую под наши требования.</p> <p>Как это было и у меня, когда я взялся за написание backend на Rust. Мне было достаточно модели <em>PBAC</em> и исходя из своего опыта разработки веб-приложений, в большинстве типовых проектов достаточно моделей <em>ACL</em>/<em>RBAC</em>.</p> <p>В связи с чем я пришел к идее реализации и вынесения собственного решения в качестве отдельного крейта с открытым исходным кодом: <em>actix-web-grants</em>.</p> <h3 id="actix-web-grants"><a href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a></h3> <p align="center"> <a href="https://github.com/DDtKey/actix-web-grants"> <img alt="actix-web-grants" src="/assets/img/posts/authz-in-rust/awg.png" /> </a> </p> <p><a href="https://github.com/DDtKey/actix-web-grants/actions"><img src="https://github.com/DDtKey/actix-web-grants/workflows/CI/badge.svg" alt="CI" /></a> <a href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/d/actix-web-grants" alt="Crates.io Downloads Badge" /></a> <a href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/v/actix-web-grants" alt="crates.io" /></a> <a href="https://docs.rs/actix-web-grants"><img src="https://docs.rs/actix-web-grants/badge.svg" alt="Documentation" /></a> <a href="https://deps.rs/repo/github/DDtKey/actix-web-grants"><img src="https://deps.rs/repo/github/DDtKey/actix-web-grants/status.svg" alt="dependency status" /></a> <img src="https://img.shields.io/crates/l/actix-web-grants" alt="Apache 2.0 or MIT licensed" /></p> <p>Основная идея проекта состоит в использовании встроенной middleware для получения привилегий пользователей из запроса и указанию необходимых разрешений у пользователей непосредственно на ваших эндпоинтах.</p> <p>Это довольно легковесный крейт с простым подключением, с использованием которого можно, как минимум, применять следующие модели: списки доступа(ACL), управление доступом на основе ролей или разрешений(RBAC/PBAC).</p> <p>Таким образом, нам достаточно реализовать функцию получения привилегий:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Sample application with grant protection based on extracting by your custom function</span>
<span class="nd">#[actix_web::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nn">HttpServer</span><span class="p">::</span><span class="nf">new</span><span class="p">(||</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">auth</span> <span class="o">=</span> <span class="nn">GrantsMiddleware</span><span class="p">::</span><span class="nf">with_extractor</span><span class="p">(</span><span class="n">extract</span><span class="p">);</span>
        <span class="nn">App</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span>
            <span class="nf">.wrap</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
            <span class="nf">.service</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nf">.bind</span><span class="p">(</span><span class="s">"localhost:8081"</span><span class="p">)</span><span class="o">?</span>
    <span class="nf">.run</span><span class="p">()</span>
    <span class="k">.await</span>
<span class="p">}</span>

<span class="k">async</span> <span class="k">fn</span> <span class="nf">extract</span><span class="p">(</span><span class="mi">_</span><span class="n">req</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ServiceRequest</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// Here is a place for your code to get user permissions/grants from a request</span>
    <span class="c">// For example from a token or database</span>
    
    <span class="c">// Stub example</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="n">ROLE_ADMIN</span><span class="nf">.to_string</span><span class="p">()])</span>
<span class="p">}</span>
</code></pre></div></div> <p>Данный подход добавляет гибкости и позволяет нам реализовывать авторизацию вне зависимости от способов аутентификации и хранения привилегий пользователей: это может быть JWT-токен, база данных, промежуточный кэш или любое другое решение.</p> <p>После чего мы можем расставлять ограничения непосредственно над нашими ресурсами:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">actix_web_grants</span><span class="p">::</span><span class="nn">proc_macro</span><span class="p">::{</span><span class="n">has_roles</span><span class="p">};</span>

<span class="nd">#[get(</span><span class="s">"/secure"</span><span class="nd">)]</span>
<span class="nd">#[has_roles(</span><span class="s">"ROLE_ADMIN"</span><span class="nd">)]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">macro_secured</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">HttpResponse</span> <span class="p">{</span>
    <span class="nn">HttpResponse</span><span class="p">::</span><span class="nf">Ok</span><span class="p">()</span><span class="nf">.body</span><span class="p">(</span><span class="s">"ADMIN_RESPONSE"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Возможность влиять на политику доступа напрямую в коде является отличительной частью actix-web-grants, снижая дублирование объектов доступа и предоставляя нам наглядную информацию о необходимых привилегиях.</p> <p>Для полноты картины, написаны минимальные примеры приложений с идентичным профилем использования и проведены замеры производительности процесса авторизации (на базе <a href="https://github.com/wg/wrk">wrk</a>) для удовлетворения собственного интереса.</p> <p>Примеры написаны с упрощенной реализацией модели RBAC для двух тест-кейсов авторизации: запрос к ресурсу разрешен и отклонен, в соответствие с наличием необходимых ролей. Для аутентификации использовались заглушки. Весь код опубликован на GitHub: <em><a href="https://github.com/DDtKey/actix-web-authz-benchmark">actix-web-authz-benchmark</a></em> (больше примеров всегда можно найти на страницах самих проектов).</p> <p>Результаты бенчмарка можете наблюдать в таблице:</p> <div class="table-responsive"> <table class="table table-bordered"> <tr> <td rowspan="2" align="center">Benchmark</td> <td colspan="2" align="center"><strong>casbin-rs</strong></td> <td colspan="2" align="center"><strong>actix-web-grants</strong></td> </tr> <tr> <td>Latency</td> <td>Req/Sec</td> <td>Latency</td> <td>Req/Sec</td> </tr> <tr> <td>Allowed Endpoint</td> <td>6.18 ms</td> <td>16.27k</td> <td>4.41 ms</td> <td>22.69k</td> </tr> <tr> <td>Denied Endpoint</td> <td>6.70 ms</td> <td>14.98k</td> <td>4.94 ms</td> <td>20.23k</td> </tr> </table> </div> <blockquote> <p><em>rustc: v1.52.0 (stable); CPU: 2,6 GHz 6-Core Intel Core i7; RAM: 16 GB</em></p> </blockquote> <p>Таким образом, мы видим, что <a href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a> позволяет более просто интегрировать и администрировать политики доступа над конечным точками (endpoint), при этом не уступает в производительности по сравнению с <a href="https://github.com/casbin/casbin-rs">casbin-rs</a>.</p> <h4 id="post-scriptum">Post Scriptum</h4> <p>Данная библиотека пока не имеет в своём арсенале интеграций с множеством веб-фреймворков, но у меня есть планы по вынесению некоторых абстракций и написанию модулей под другие фреймворки, внесению некоторых улучшений (например, возможность наследования ролей и поддержки пользовательских типов). Буду рад любым предложениям и вкладу!</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="https://ddtkey.com/ru/blog/authz-mechanisms-in-Rust/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Artem Medvedev </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="https://ddtkey.com/assets/img/authors/ddtkey.png" alt="Artem Medvedev" /> </div> <div class="col-md-6"> <p class="author_bio">Hi, my name is Artem. I'm a backend developer (Rust, Java)</p> <p>Email : <a href="mailto:%69@%64%64%74%6B%65%79.%63%6F%6D" title="Contact me">i@ddtkey.com</a></p> <p>Website : https://ddtkey.com</p> <p class="profile-links"> <a class="social-link" href="https://github.com/DDtKey" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/ddtkey" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/DDttKey" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> <a class="social-link" href="https://instagram.com/ddttkey" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> <a class="social-link" href="https://telegram.com/DDtKey" target="_blank"><i class="fab fa-telegram fa-fw"></i></a> </p> </div> </div> </div> </div> </div><div class="giscus" id="giscus_thread"></div></article> <script src="https://giscus.app/client.js" data-repo="DDtKey/DDtKey.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzNjU4NTk0NjY=" data-category="Announcements" data-category-id="DIC_kwDOFc6Sis4CAbCS" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async> </script></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">Обо мне Артем Медведев</div> <div class="card-body"> <p class="author_bio">Мне <span id="age-container"></span>, работаю backend-разработчиком (Rust, Java), но для меня это больше, чем работа 👨🏻‍💻 <br/> Постоянно стремлюсь к профессиональному развитию, получению новых знаний и возможностей 🚀</p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/DDtKey" data-size="large" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-show-count="true" aria-label="Follow @DDtKey on GitHub">Follow @DDtKey</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Категории</div> <div class="card-body text-dark"> <div id="#rust"></div> <li class="tag-head"> <a href="/ru/blog/category/rust">rust</a> </li> <a name="rust"></a> <div id="#authz"></div> <li class="tag-head"> <a href="/ru/blog/category/authz">authz</a> </li> <a name="authz"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Полезные ссылки</div> <div class="card-body text-dark"> <li> <a href="https://ddtkey.com/ru/">Главная</a> </li> <li> <a href="https://ddtkey.com/ru/blog">Блог</a> </li> <li> <a href="https://ddtkey.com/ru/about">Обо мне</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll theme</a> and available on <a href="https://github.com/DDtKey/DDtKey.github.io">GitHub</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script src="https://ddtkey.com/assets/js/mode-switcher.js"></script> </body> </html>
